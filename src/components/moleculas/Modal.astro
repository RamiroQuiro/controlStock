---
import { dataFormularioContexto } from '../../context/store';
import Button1 from '../atomos/Button1.astro';
import { CircleX, X } from 'lucide-react';
const { id, label, title } = Astro.props;

dataFormularioContexto.set({ isEdit: false });
---

<div data-id={id}>
  {label && <Button1 id={`modal-open-${id}`}>{label}</Button1>}

  <dialog
    id={`dialog-modal-${id}`}
    class="modal print:hidden relative duration-300 open:fixed open:flex flex-col w-full max-w-[75vw] rounded-lg backdrop:bg-primary-textoTitle/80 open:backdrop:backdrop-blur-sm max-h-[90vh] overflow-hidden"
  >
    {/* Header Fijo */}
    <div
      class="flex justify-between items-center p-4 border-b bg-primary-bg-componentes flex-shrink-0"
    >
      <h3 class="text-xl font-semibold text-gray-800">{title}</h3>
      <button
        id={`modal-close-${id}`}
        class="text-gray-500 hover:text-red-600 transition-colors rounded-full p-1"
      >
        <CircleX size={24} />
      </button>
    </div>

    {/* Contenido con Scroll */}
    <div class="p-6 overflow-y-auto flex-grow">
      <slot />
    </div>
  </dialog>
</div>

<script define:vars={{ id }}>
  const openBtn = document.getElementById(`modal-open-${id}`);
  const closeBtn = document.getElementById(`modal-close-${id}`);
  const dialog = document.getElementById(`dialog-modal-${id}`);

  openBtn?.addEventListener('click', () => {
    dialog?.showModal();
  });

  closeBtn?.addEventListener('click', () => {
    dialog?.close();
  });

  // Opcional: cerrar al hacer clic en el backdrop
  dialog?.addEventListener('click', (event) => {
    if (event.target === dialog) {
      dialog.close();
    }
  });
</script>

<style>
  .modal {
    z-index: 1000; /* Ajusta si es necesario */
  }
  /* Elimina el padding por defecto del dialog */
  dialog::backdrop {
    background-color: rgba(0, 0, 0, 0.5);
  }
  dialog {
    padding: 0;
  }
</style>

<script>
  import { dataFormularioContexto } from '../../context/store';

  const emptyForm = {
    dni: 0,
    id: '',
    isEdit: false,
    nombre: '',
    apellido: '',
    email: '',
    password: '',
    rol: 'vendedor',
    tipoUsuario: 'empleado',
  };
  dataFormularioContexto.set({ ...emptyForm, isEdit: false });
</script>
