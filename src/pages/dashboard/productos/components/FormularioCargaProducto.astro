---
import FormularioCargaProducto from './FormularioCargaProducto.tsx';
import db from '../../../../db';
import { depositos as depositosTable, ubicaciones as ubicacionesTable } from '../../../../db/schema';
import { eq } from 'drizzle-orm';

const { user } = Astro.locals;

// 1. Obtener los datos necesarios en el servidor
const depositos = await db.select({ id: depositosTable.id, nombre: depositosTable.nombre }).from(depositosTable).where(eq(depositosTable.empresaId, user.empresaId));
const ubicaciones = await db.select({ id: ubicacionesTable.id, nombre: ubicacionesTable.nombre, depositoId: ubicacionesTable.depositoId }).from(ubicacionesTable).where(eq(ubicacionesTable.empresaId, user.empresaId));
---

<!-- 2. Renderizar la isla de React, pasÃ¡ndole los datos como props -->
<FormularioCargaProducto 
    client:load 
    depositos={depositos} 
    ubicaciones={ubicaciones} 
    userId={user.id}
    empresaId={user.empresaId}
/>
